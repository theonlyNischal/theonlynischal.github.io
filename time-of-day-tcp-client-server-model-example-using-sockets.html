<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>Simple time-of-day TCP Client-Server model example using sockets in C
 | Nischal Lal Shrestha</title>
      <meta property='og:type' content='website'>
      <meta property='og:locale' content='en_US'>
      <meta property='wagtail:language' content='en'>
      <link rel="alternate" type="application/rss+xml" href="/en/blog/rss/" />
      <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Simple time-of-day TCP Client-Server model example using sockets in C, Published On:Wed, Oct 14 2020, keywords: tcp, sockets, c, tcp example, client-server model, sockets example, ">
    <meta name="keywords" content="tcp, sockets, c, tcp example, client-server model, sockets example, " />
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Simple time-of-day TCP Client-Server model example using sockets in C">
    <meta property="og:description" content="In a client-server model, a server is an application program that offers a service over a network. The server's code runs first, which opens a port and accepts an incoming request. When a request arrives it forms a response and returns the result to the requester. A program becomes a client when it sends a request to a server and waits for a response.">
    <meta property="og:url" content="https://nischal.info.np/time-of-day-tcp-client-server-model-example-using-sockets">
    <meta property="og:image" content="https://nischal.info.np/theme/img/code/sockets-simple-time-of-day-server-in-c.png">
    <meta property="og:site_name" content="Nischal Lal Shrestha">
    <!-- Markup for Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@dakkulanthu">
    <meta name="twitter:title" content="Simple time-of-day TCP Client-Server model example using sockets in C">
    <meta name="twitter:description" content="In a client-server model, a server is an application program that offers a service over a network. The server's code runs first, which opens a port and accepts an incoming request. When a request arrives it forms a response and returns the result to the requester. A program becomes a client when it sends a request to a server and waits for a response.">
    <meta name="twitter:creator" content="@dakkulanthu">
    <meta name="twitter:image" content="https://nischal.info.np/theme/img/code/sockets-simple-time-of-day-server-in-c.png">
    <meta name="google-site-verification" content="iEvAoBxEoIpSiA4IZmG1FN9E_kBBkq7453c8krLFbpY" />
    <meta name="ahrefs-site-verification" content="eb6c465128e0ba9eb3ff9730abec8b97b91f55db6ebadf734372fed79414e07c">
    <link rel="canonical" href="./time-of-day-tcp-client-server-model-example-using-sockets.html" />
    
      <meta name="google-site-verification" content="D7k-r3fHm-XfJ9E7T1uZ5aqHJG2mx-0uUZFeBUDN2lY">
      <meta name="ga-identifier" content="UA-87658599-6">
      <meta name="gtm-identifier" content="GTM-MD3XGZ4">
      
      <script src="https://nischal.info.np/theme/js/protocol-base.js"></script>
      <script src="https://nischal.info.np/theme/js/protocol-support.js"></script>
      <script src="https://nischal.info.np/theme/js/protocol-utils.js"></script>
      <link rel="stylesheet" href="https://nischal.info.np/theme/uswds-2.11.2/css/uswds.min.css" />
      <link rel="stylesheet" href="https://nischal.info.np/theme/css/protocol.css">
      <link rel="stylesheet" href="https://nischal.info.np/theme/css/protocol-components.css">
      <link rel="stylesheet" href="https://nischal.info.np/theme/css/main.css">
      <link rel="stylesheet" href="https://nischal.info.np/theme/css/my-touch.css">
      <link rel="stylesheet" href="https://nischal.info.np/theme/css/pygments.css">
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,300,700,300i,800,900">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Zilla+Slab:300,400,600,700,300i">
      <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://nischal.info.np/theme/img/favicon.png">
      <link rel="icon" type="image/png" sizes="196x196" href="https://nischal.info.np/theme/img/favicon.png">
      <link rel="shortcut icon" href="https://nischal.info.np/theme/img/favicon.png">
      <link rel="canonical" href="https://nischal.info.np">
      <script src="https://nischal.info.np/theme/js/main.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
      <script src="https://nischal.info.np/theme/uswds-2.11.2/js/uswds-init.min.js"></script>

      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-3ZR069LM8Q"></script>
      <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-3ZR069LM8Q');
   </script>
   <!-- Google Adsense -->
   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2612172848875712"
   crossorigin="anonymous"></script>


   <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EX6KCZD89Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EX6KCZD89Z');
</script>


      
   </head>
   <body class="" id="view-blog-index">
      <div class="wrapper">
<div class="sticky-top d-print-none">
    <div class="primary-nav-container">
        <div class="wrapper-burger">
            <div class="menu-container">
                <div class="narrow-screen-menu hidden d-lg-none">
                <div class="narrow-screen-menu-background dark-theme">
                    <div class="narrow-screen-menu-container">
                        <div class="container" role="navigation">
                            <div class="row">
                                <div class="col">
                                    <div class="nav-links pt-3">
                                        <div><a class="" href="https://nischal.info.np">Home</a></div>
                                            <div><a  href="https://nischal.info.np/category/algorithm.html">Algorithm</a></div>

                                            <div><a class="active" href="https://nischal.info.np/category/code.html">Code</a></div>

                                            <div><a  href="https://nischal.info.np/category/open-source.html">Open Source</a></div>

                                            <div><a  href="https://nischal.info.np/category/thoughts.html">Thoughts</a></div>

                                            <br>
<div class="row">
    <div class="col-12">
        <hr class="intro-and-content-divider">
    </div>
</div>                                            <div><a  href="https://nischal.info.np/nischal.html"><i class="la-lg las la-user"></i>  About Me</a></div>
                                            <div><a  href="https://nischal.info.np/projects.html"><i class="la-lg las la-file-code"></i>  Projects</a></div>
                                            <div><a  href="https://nischal.info.np/contact.html"><i class="la-lg las la-phone-volume"></i> Contact</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                <nav class="container wide-screen-menu-container" title="main site navigation">
                <div class="row">
                    <div class="col">
                        <div class="d-flex flex-row justify-content-between">
                            <div id="primary-nav-links">
                                <div class="d-flex align-items-center flex-wrap">
                                    <button class="burger  d-lg-none ml-md-0 " aria-label="Open menu">
                                        <div class="burger-bar burger-bar-top"></div>
                                        <div class="burger-bar burger-bar-middle"></div>
                                        <div class="burger-bar burger-bar-bottom"></div>
                                    </button>
                                    <a class="logo text-hide" href="/" aria-label="Nischal Lal Shrestha">Nischal Lal Shrestha</a>
                                    <div class="wide-screen-menu">
                                        <div class="nav-links d-none d-lg-block">
                                                <a  href="https://nischal.info.np/category/algorithm.html">Algorithm</a>
                                                <a class="active" href="https://nischal.info.np/category/code.html">Code</a>
                                                <a  href="https://nischal.info.np/category/open-source.html">Open Source</a>
                                                <a  href="https://nischal.info.np/category/thoughts.html">Thoughts</a>
 
                                                <a id=""  class="primary-nav-special-link  no-underline" href="https://nischal.info.np/nischal.html" ><i class="la-lg las la-user"></i>  About Me</a>
                                            
                                                <a id=""  class="primary-nav-special-link  no-underline" href="https://nischal.info.np/projects.html" ><i class="la-lg las la-file-code"></i>  Projects</a>
                                                
                                                <a id=""  class="primary-nav-special-link  no-underline" href="https://nischal.info.np/contact.html"><i class="la-lg las la-phone-volume"></i>  Contact</a>
                                        </div>
                                        

                                    </div>
                                </div>
                            </div>
                            <!-- Right -->
                            <div class="d-flex align-items-center">

                            </div>
                            

                        </div>
                    </div>
                </div>
                </nav>
            </div>
        </div>
    </div>
</div>
         <header role="banner">
         </header>
         
         <main role="main" id="main-content" class="main-content">
            <div class="container">
              

    <div class="row" style="justify-content: center;">
        <aside class="usa-in-page-nav" aria-label="On this page" data-scroll-offset="-120" data-root-margin="48px 0px -90% 0px" data-threshold="1">

        </aside>
        <!-- <div class="offset-lg-1 col-lg-1 py-4 py-md-5 text-center d-print-none">
            <div class="blog-sticky-side d-none d-lg-flex justify-content-lg-end">
            <div class="share-button-group-wrapper" data-version="mini" data-layout="stacked" data-share-text="Simple time-of-day TCP Client-Server model example using sockets in C" data-link="https://nischal.info.np/time-of-day-tcp-client-server-model-example-using-sockets"></div>
            </div>
        </div> -->
        <div class="py-4 py-md-5 col-lg-8">
            <div class="cms ">
            <h1 class="h1-heading">Simple time-of-day TCP Client-Server model example using sockets in C</h1>
                <div class="blog-authors d-flex flex-wrap flex-column mb-4">
                    <p class="body-small my-2">
                        By
                        <span><b><a href="https://nischal.info.np/author/nischal-lal-shrestha.html">Nischal Lal Shrestha</a></b></span>
                        | On Wed, Oct 14 2020
                        | Filed under <span class="usa-tag"><a href="https://nischal.info.np/category/code.html">Code</a></span>
                    </p>
                </div>
            <div class="blog-body">
                <figure class="my-default">
                    <img src="https://nischal.info.np/theme/img/code/sockets-simple-time-of-day-server-in-c.png" alt="Image for Simple time-of-day TCP Client-Server model example using sockets in C" class="w-100" />
                    <figcaption class="body-small d-block mt-2">
                        
                    </figcaption>
                </figure>
                <div class="rich-text">
                    <p>This program returns time of day whenever a client send server a packet.
Using this example we will understand basics of TCP sockets.</p>
<p>In a client-server model, a server is an application program that offers a service over a network. The
server's code runs first, which opens a port and accepts an incoming request. When a request arrives
it forms a response and returns the result to the requester.
A program becomes a client when it sends a request to a server and waits
for a response.</p>
<div class="usa-summary-box"
  role="region"
  aria-labelledby="summary-box-key-information"
>
  <div class="usa-summary-box__body">
    <h3 class="usa-summary-box__heading" id="summary-box-key-information">
      Source code for other similar programs
    </h3>
    <div class="usa-summary-box__text">
      <ul class="usa-list" style="list-style-type: disc;">
        <li><a href="https://github.com/theonlyNischal/Network-Programming-Lab-Assignments-NCIT/tree/main/01-day-of-time" class="usa-link usa-link--external">Time of day client-server program using TCP sockets </a></li>
        <li><a href="https://github.com/theonlyNischal/Network-Programming-Lab-Assignments-NCIT/tree/main/02-simple-echo-program" class="usa-link usa-link--external">Example of echo server using TCP sockets </a></li>
        <li><a href="https://github.com/theonlyNischal/Network-Programming-Lab-Assignments-NCIT/tree/main/03-simple-chat-program" class="usa-link usa-link--external">Simple chat using TCP sockets </a></li>
        <li><a href="https://github.com/theonlyNischal/Network-Programming-Lab-Assignments-NCIT/tree/main/04-concurrent-echo" class="usa-link usa-link--external">Echo server but built with concurrent server </a></li>
        <li><a href="https://github.com/theonlyNischal/Network-Programming-Lab-Assignments-NCIT/tree/main/05-concurrent-chat" class="usa-link usa-link--external">Simple chat but built with concurrent server </a></li>
        <li><a href="https://github.com/theonlyNischal/Network-Programming-Lab-Assignments-NCIT/tree/main/06-TCP-Quiz" class="usa-link usa-link--external">Implementation of a TCP Quiz program  </a></li>
        <li><a href="https://github.com/theonlyNischal/Network-Programming-Lab-Assignments-NCIT/tree/main/07-provide-registration-number" class="usa-link usa-link--external">[WIP] Provide Registration Number </a></li>
        <li><a href="https://github.com/theonlyNischal/Network-Programming-Lab-Assignments-NCIT/tree/main/08-client-to-client-chat" class="usa-link usa-link--external">[WIP] Client-to-Client Communication Chat </a></li>
      </ul>
    </div>
  </div>
</div>
<br><div class="section" id="time-of-day">
<h2>Time-of-Day</h2>
<p>Here, when a client is connected to a server. The server will send current time information to
the client and the client will print the information in the screen.</p>
<div class="section" id="server-side-code">
<h3>Server Side Code</h3>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/socket.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;netinet/in.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arpa/inet.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;errno.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>

<span class="cp">#define MAXLINE 1024</span>
<span class="cp">#define LISTENQ 10</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">){</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">listenfd</span><span class="p">,</span><span class="w"> </span><span class="n">connfd</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="w"> </span><span class="n">servaddr</span><span class="p">,</span><span class="w"> </span><span class="n">cliaddr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buff</span><span class="w"> </span><span class="p">[</span><span class="n">MAXLINE</span><span class="p">];</span>
<span class="w">    </span><span class="kt">time_t</span><span class="w"> </span><span class="n">ticks</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">;</span>
<span class="w">    </span><span class="kt">socklen_t</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>

<span class="w">    </span><span class="n">listenfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Creates a TCP Socket</span>

<span class="w">    </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="n">bzero</span><span class="p">(</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span>
<span class="w">    </span><span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET</span><span class="p">;</span>
<span class="w">    </span><span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
<span class="w">    </span><span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>

<span class="w">    </span><span class="n">bind</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Server is waiting connection at port %d</span><span class="se">\t\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">port</span><span class="p">);</span>
<span class="w">    </span><span class="n">listen</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span><span class="w"> </span><span class="n">LISTENQ</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cliaddr</span><span class="p">);</span>
<span class="w">        </span><span class="n">connfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accept</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cliaddr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Connection from %s, port %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">cliaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">,</span><span class="w"> </span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">)),</span><span class="w"> </span><span class="n">ntohs</span><span class="p">(</span><span class="n">cliaddr</span><span class="p">.</span><span class="n">sin_port</span><span class="p">));</span>
<span class="w">        </span><span class="n">ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">        </span><span class="n">snprintf</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%.24s</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ticks</span><span class="p">));</span>
<span class="w">        </span><span class="n">write</span><span class="p">(</span><span class="n">connfd</span><span class="p">,</span><span class="w"> </span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">buff</span><span class="p">));</span>
<span class="w">        </span><span class="n">close</span><span class="p">(</span><span class="n">connfd</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="include-header-files">
<h3>1. Include header files</h3>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/socket.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;netinet/in.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arpa/inet.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;errno.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>
</pre></div>
<p>These line includes numerous system headers that are needed by most network programs</p>
</div>
<div class="section" id="defines-constants">
<h3>2. Defines Constants</h3>
<div class="highlight"><pre><span></span><span class="cp">#define MAXLINE 1024</span>
<span class="cp">#define LISTENQ 10</span>
</pre></div>
<p>Defines various constants that we use(e.g., MAXLINE, LISTENQ)</p>
</div>
<div class="section" id="gives-type-struct-sockaddr-a-new-name-to-shorten-the-code">
<h3>3. Gives type &quot;struct sockaddr&quot; a new name to shorten the code.</h3>
<div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>
</pre></div>
<ol class="arabic simple" start="4">
<li>Starts main function and it accepts command line arguments.</li>
</ol>
<div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">){</span>
</pre></div>
<p><strong>argc</strong> (argument count) and <strong>argv</strong> (argument vector) are how command line arguments
are passed to <strong>main()</strong> in C and C++.</p>
<p><strong>argc</strong> will be the number of strings pointed to by <strong>argv</strong>.</p>
</div>
<div class="section" id="creates-a-tcp-socket">
<h3>5. Creates a TCP Socket.</h3>
<div class="highlight"><pre><span></span><span class="n">listenfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Creates a TCP Socket</span>
</pre></div>
<p>The socket function creates a socket on demand. The function takes three integer
arguments and returns an integer descriptor which we can use to identify the socket
in all future function calls (e.g., the calls to connect and
read that follow).</p>
</div>
<div class="section" id="initialize-the-server-address-by-the-port-and-ip">
<h3>6.Initialize the server address by the port and IP.</h3>
<div class="highlight"><pre><span></span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="n">bzero</span><span class="p">(</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span>
<span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET</span><span class="p">;</span>
<span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
<span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="bind-the-socket-descriptor-to-the-server-address">
<h3>7. Bind the socket descriptor to the server address.</h3>
<div class="highlight"><pre><span></span><span class="n">bind</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span>
</pre></div>
<p>Once a socket has been created, a server uses the bind function to establish a local address for
the socket†. Bind has the following form.</p>
<div class="highlight"><pre><span></span><span class="n">bind</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="n">localaddr</span><span class="p">,</span><span class="w"> </span><span class="n">addrlen</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="turn-on-the-socket-to-listen-for-incoming-connections">
<h3>8. Turn on the socket to listen for incoming connections.</h3>
<div class="highlight"><pre><span></span><span class="n">listen</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span><span class="w"> </span><span class="n">LISTENQ</span><span class="p">);</span>
</pre></div>
<p>Socket function listen allows servers to prepare a socket for incoming connections.
In terms of the underlying protocols, listen puts the socket in a passive mode ready to
accept connections. Only servers use listen. In addition to placing a protocol in passive
mode, listen contains an argument that configures the size of a queue for incoming re-
quests.
A call has the form:</p>
<div class="highlight"><pre><span></span><span class="n">listen</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="n">qlength</span><span class="p">);</span>
</pre></div>
<p>Argument descriptor gives the descriptor of a socket that should be prepared for use by
a server, and argument qlength specifies the length of the request queue for that socket.</p>
</div>
<div class="section" id="infinite-loop">
<h3>9. Infinite loop</h3>
<div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="store-the-clients-address-and-socket-descriptor-by-accepting-an-incoming-connection">
<h3>10. Store the client’s address and socket descriptor by accepting an incoming connection.</h3>
<div class="highlight"><pre><span></span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cliaddr</span><span class="p">);</span>
<span class="n">connfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accept</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cliaddr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
</pre></div>
<p>Once a socket has been established, the server needs to wait for a connection. To
do so, the server calls function accept. A call to accept blocks until a new connection
request arrives. The call has the form:</p>
<div class="highlight"><pre><span></span><span class="n">newsock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accept</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">addrlen</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="sending-data-through-a-socket">
<h3>11. Sending data through a socket.</h3>
<div class="highlight"><pre><span></span><span class="n">ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="n">snprintf</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%.24s</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ticks</span><span class="p">));</span>
<span class="n">write</span><span class="p">(</span><span class="n">connfd</span><span class="p">,</span><span class="w"> </span><span class="n">buff</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">buff</span><span class="p">));</span>
</pre></div>
<p>This calculate current time and send it to client through socket.</p>
</div>
<div class="section" id="terminate-the-connection">
<h3>12. Terminate the connection.</h3>
<div class="highlight"><pre><span></span><span class="n">close</span><span class="p">(</span><span class="n">connfd</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="client-side-code">
<h3>Client Side Code</h3>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/socket.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;netinet/in.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;arpa/inet.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;errno.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>

<span class="cp">#define MAXLINE 1024</span>
<span class="cp">#define LISTENQ 10</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr</span><span class="w"> </span><span class="n">SA</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">){</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sockfd</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">recvline</span><span class="w"> </span><span class="p">[</span><span class="n">MAXLINE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="w"> </span><span class="n">servaddr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: a.out &lt;IPaddress&gt; &lt;port no.&gt;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">sockfd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"> </span><span class="c1">// Creates a TCP Socket</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Socket Error&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"> </span><span class="c1">// ascii to integer conversion</span>

<span class="w">    </span><span class="n">bzero</span><span class="p">(</span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">));</span><span class="w"> </span><span class="c1">// fills servaddr with zeros.</span>

<span class="w">    </span><span class="n">servaddr</span><span class="p">.</span><span class="n">sin_family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AF_INET</span><span class="p">;</span>
<span class="w">    </span><span class="n">servaddr</span><span class="p">.</span><span class="n">sin_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// pton = presentatin to network</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;inet_pton error for %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">SA</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">servaddr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">servaddr</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">     </span><span class="c1">// Establishes a TCP Connnection</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Connect Error.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">n</span><span class="o">=</span><span class="n">read</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span><span class="w"> </span><span class="n">recvline</span><span class="p">,</span><span class="w"> </span><span class="n">MAXLINE</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// reads server reply.</span>
<span class="w">        </span><span class="n">recvline</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fputs</span><span class="p">(</span><span class="n">recvline</span><span class="p">,</span><span class="w"> </span><span class="n">stdout</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EOF</span><span class="p">){</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;fputs error.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;read error&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>



<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="instructions-for-lab-1">
<h3>Instructions for Lab 1</h3>
<ol class="arabic simple">
<li>Create two files for the Client and server program named as daytimetcpserver.c and daytimetcpclient.c</li>
<li>Write a server and client program</li>
<li>Save both files in the same directory</li>
<li>Compile both programs using GCC compiler.</li>
</ol>
<p>example: gcc -o server daytimetcpserver.c (It creates an output file server)</p>
<p>do similar for client program</p>
<ol class="arabic simple" start="5">
<li>Open terminal and run server program</li>
</ol>
<p>example: ./server &lt;portno&gt;  (Specify port number)</p>
<p>6: In another terminal run client program</p>
<p>example: ./client &lt;server ip&gt; &lt;port no&gt; (Specify server ip and port no)</p>
<ol class="arabic simple" start="7">
<li>Observer an output.</li>
<li>Submit your code</li>
</ol>
</div>
</div>

                </div>
                <!-- <div class="share-button-group-wrapper mt-5 d-print-none" data-share-text="Simple time-of-day TCP Client-Server model example using sockets in C" data-link="https://nischal.info.np/time-of-day-tcp-client-server-model-example-using-sockets"></div> -->
            </div>
            <br/>



            <div id="disqus_thread"></div>
                <script>
                    /**
                    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                    */
                    /*
                    var disqus_config = function () {
                        this.page.url = https://nischal.info.np;  // Replace PAGE_URL with your page's canonical URL variable
                        this.page.identifier = time-of-day-tcp-client-server-model-example-using-sockets; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                    };
                    */
                    (function() {  // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');
                        
                        s.src = 'https://shresthanischal.disqus.com/embed.js';
                        
                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                            
            </div>
        </div>
    </div>

               
            </div>
         </main>



<footer class="mzp-c-footer">
	<div class="mzp-l-content ">
		<nav class="mzp-c-footer-primary">
			<div class="mzp-c-footer-primary-logo">
				<a href="https://nischal.info.np">Nischal Lal Shrestha</a>
			</div>
			<div class="mzp-c-footer-sections">
				<section class="mzp-c-footer-section">
					<h5 class="mzp-c-footer-heading">
    Explore
  </h5>
					<ul class="mzp-c-footer-list">
							<li><a href="https://nischal.info.np/category/algorithm.html">Algorithm</a></li>
							<li><a href="https://nischal.info.np/category/code.html">Code</a></li>
							<li><a href="https://nischal.info.np/category/open-source.html">Open Source</a></li>
							<li><a href="https://nischal.info.np/category/thoughts.html">Thoughts</a></li>
					</ul>
				</section>
				<section class="mzp-c-footer-section">
					<h5 class="mzp-c-footer-heading">
    About
  </h5>
					<ul class="mzp-c-footer-list">
                        <li><a href="https://nischal.info.np/nischal.html">About Me</a></li>
                        <li><a href="https://nischal.info.np/projects.html">Projects</a></li>
                        <li><a href="https://nischal.info.np/contact.html">Contact</a></li>
					</ul>
				</section>
				<section class="mzp-c-footer-section">
					<h5 class="mzp-c-footer-heading">
    Website Credits
  </h5>
					<ul class="mzp-c-footer-list">
						<li><a href="https://protocol.mozilla.org/" rel="nofollow">Mozilla Protocol</a></li>
						<li><a href="https://designsystem.digital.gov/how-to-use-uswds/" rel="nofollow">
							USWD </a></li>
						<li><a href="https://docs.getpelican.com/en/stable/index.html" rel="nofollow">Pelican</a></li>
						<li><a href="https://icons8.com/line-awesome" rel="nofollow">Line Awesome</a></li>
						<li><a href="https://pages.github.com/" rel="nofollow">Github Pages</a></li>
						<li><a href="https://unsplash.com/" rel="nofollow">Unsplash</a></li>
					</ul>
				</section>
			</div>
		</nav>
		<nav class="mzp-c-footer-secondary">
			<ul class="mzp-c-footer-links-social">
				<li>
					<a class="twitter" href="https://twitter.com/dakkulanthu" rel="nofollow">Twitter
						<span> (@dakkulanthu)</span>
					</a>
				</li>
				<li>
					<a class="youtube" href="https://www.youtube.com/channel/UCQoieW45COakbskXxW_ANIw" rel="nofollow">YouTube
						<span> (Nischal Lal Shrestha)</span>
					</a>
				</li>
			</ul>

			<div class="mzp-c-footer-legal">
				<p class="mzp-c-footer-license">Hey there, I'm Nischal.
						<br/>
						I am a student, a developer. Currently learning ML, DL, Data Science, Python.
				</p>

				<p class="mzp-c-footer-license">I love Everything that makes me more Human.
				<br/>
				<br/>
				 While not Coding, I play Football and Chess.
				</p class="mzp-c-footer-license">

				<p mzp-c-footer-license>Copyright text 2020 by Nischal!!</p>
				
				<ul class="mzp-c-footer-terms">
				<li><a href="https://nischal.info.np/cookies.html">Cookies</a></li>
				<li><a href="https://nischal.info.np/privacy.html">Privacy Policy</a></li>
				<li><a href="https://nischal.info.np/disclaimer.html">Disclaimer</a></li>
				<li><a href="https://nischal.info.np/code-of-conduct.html">Code of Conduct</a></li>
				
				</ul>
      		</div>

		</nav>
	</div>
</footer>      </div>
      <script src="https://nischal.info.np/theme/uswds-2.11.2/js/uswds.min.js"></script>
      <script src="https://nischal.info.np/theme/js/main.js"></script>
      <script src="https://nischal.info.np/theme/js/hangul_interactive_dashboard_script.js"></script>
   </body>
</html>
